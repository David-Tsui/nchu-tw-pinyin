function search_char(e){$.post(servicePath+"search_word.php",{search_KEY:search_key,MODE:e},function(t){if(""==t)$("#show, #show_flat").html("無此拼音，請按backspace或delete調整拼音"),$("#chatAudio")[0].play(),associated_search_flag=!1,mode=0;else if("associated pinyin"==t[0]){number_letters=Object.keys(t).length-1,currentPage=1,getPage(),candidate_letter=[];for(var n=0;number_letters>n;n++)candidate_letter[n]=t[n+1];if(1==totalPage){for(var o="",i="",n=0;number_letters>n;n++)o+="● "+candidate_letter[n]+"\n",i+=3==n?"● "+candidate_letter[n]+"\n":7==n?"● "+candidate_letter[n]+"\n":"● "+candidate_letter[n]+" ";o="拼音提示"+interval+"("+currentPage+"/"+totalPage+")\n"+o,$("#show").html(o),$("#show_flat").html(i)}else{for(var o="",i="",r=!1,n=0;10>n;n++)o+="● "+candidate_letter[n]+"\n",3==n?i+="● "+candidate_letter[n]+"\n":7==n&&candidate_letter[n+1].length<=4&&candidate_letter[n+2].length<=4?(i+="● "+candidate_letter[n]+"\n",r=!0):i+=7==n&&candidate_letter[n+1].length>1?"● "+candidate_letter[n]+" +:下頁\n":"● "+candidate_letter[n]+" ";o+="+:下一頁",o="拼音提示"+interval+"("+currentPage+"/"+totalPage+")\n"+o,1==r&&(i+=" +:下頁"),$("#show").html(o),$("#show_flat").html(i)}associated_search_flag=!0,mode=0}else if("modify letter"==t[0]){number_letters=Object.keys(t[1]).length;var a=Object.keys(t[2]).length;currentPage=1,getPage(),candidate_letter=[],mod_pinyin_record=[];for(var n=0;number_letters>n;n++)candidate_letter[n]=t[1][n];for(var n=0;a>n;n++){if(0==n)var c=new modify_record_obj(t[2][n],0,t[3][n]);else var c=new modify_record_obj(t[2][n],t[3][n-1],t[3][n]);mod_pinyin_record[n]=c}if(1==totalPage){for(var o="",i="",_=1,n=0;number_letters>n;n++)o+=_+". "+candidate_letter[n]+"\n",i+=3==n?_+". "+candidate_letter[n]+"\n":7==n?_+". "+candidate_letter[n]+"\n":_+". "+candidate_letter[n]+" ",_++,10==_&&(_=0);o="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+o,$("#show").html(o),$("#show_flat").html(i)}else{for(var o="",i="",r=!1,_=1,n=0;10>n;n++)o+=_+". "+candidate_letter[n]+"\n",3==n?i+=_+". "+candidate_letter[n]+"\n":7==n&&candidate_letter[n+1].length<=4&&candidate_letter[n+2].length<=4?(i+=_+". "+candidate_letter[n]+"\n",r=!0):i+=7==n&&candidate_letter[n+1].length>1?_+". "+candidate_letter[n]+" +:下頁\n":_+". "+candidate_letter[n]+" ",_++,10==_&&(_=0);o+="+:下一頁",o="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+o,1==r&&(i+=" +:下頁"),$("#show").html(o),$("#show_flat").html(i)}}else{if(0==e||2==e){number_letters=Object.keys(t).length,currentPage=1,getPage(),candidate_letter=[],mod_pinyin_record=[];for(var n=0;number_letters>n;n++)candidate_letter[n]=t[n];if(1==totalPage){for(var o="",i="",_=1,n=0;number_letters>n;n++)o+=_+". "+candidate_letter[n]+"\n",i+=3==n?_+". "+candidate_letter[n]+"\n":7==n?_+". "+candidate_letter[n]+"\n":_+". "+candidate_letter[n]+" ",_++,10==_&&(_=0);o="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+o,$("#show").html(o),$("#show_flat").html(i)}else{for(var o="",i="",r=!1,_=1,n=0;10>n;n++)o+=_+". "+candidate_letter[n]+"\n",3==n?i+=_+". "+candidate_letter[n]+"\n":7==n&&candidate_letter[n+1].length<=4&&candidate_letter[n+2].length<=4?(i+=_+". "+candidate_letter[n]+"\n",r=!0):i+=7==n&&candidate_letter[n+1].length>1?_+". "+candidate_letter[n]+" +:下頁\n":_+". "+candidate_letter[n]+" ",_++,10==_&&(_=0);o+="+:下一頁",o="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+o,1==r&&(i+=" +:下頁"),$("#show").html(o),$("#show_flat").html(i)}3!=mode&&(mode=1)}pronunce_key=search_key.substring(search_key.lastIndexOf(" ")+1,search_key.length),void 0===$("#pro_sound_"+pronunce_key).html()?play_sound_flag&&$.getJSON(servicePath+"check_sound.php",{SOUND:pronunce_key},function(e){1==e[0]&&("p"==pronunce_key.charAt(pronunce_key.length-1)||"t"==pronunce_key.charAt(pronunce_key.length-1)||"k"==pronunce_key.charAt(pronunce_key.length-1)||"h"==pronunce_key.charAt(pronunce_key.length-1)?($('<audio id="pro_sound_'+pronunce_key+'"><source src="./pronunce/'+pronunce_key.toUpperCase()+'5.wav" type="audio/wav"></audio>').appendTo("body"),$("#pro_sound_"+pronunce_key)[0].play()):($('<audio id="pro_sound_'+pronunce_key+'"><source src="./pronunce/'+pronunce_key.toUpperCase()+'1.wav" type="audio/wav"></audio>').appendTo("body"),$("#pro_sound_"+pronunce_key)[0].play()))}):play_sound_flag&&$("#pro_sound_"+pronunce_key)[0].play(),associated_search_flag=!1}},"json")}function search_associated(){var e=prefix_key.length;$.post(servicePath+"search_associated.php",{prefix_KEY:prefix_key},function(t){if(""==t)return $("#show, #show_flat").html(""),void(mode=0);candidate_letter=[],number_letters=Object.keys(t).length,getPage();for(var n=0;number_letters>n;n++){var o=t[n],i=o.length;candidate_letter[n]=o.substr(e,i-e)}if(1==totalPage){for(var r="",a="",c=1,n=0;number_letters>n;n++)r+=c+". "+candidate_letter[n]+"\n",a+=3==n?c+". "+candidate_letter[n]+"\n":7==n?c+". "+candidate_letter[n]+"\n":c+". "+candidate_letter[n]+" ",c++,10==c&&(c=0);r="關聯詞"+interval+"("+currentPage+"/"+totalPage+")\n"+r,$("#show").html(r),$("#show_flat").html(a)}else{for(var r="",a="",c=1,_=!1,n=0;10>n;n++)r+=c+". "+candidate_letter[n]+"\n",3==n?a+=c+". "+candidate_letter[n]+"\n":7==n&&candidate_letter[n+1].length<=4&&candidate_letter[n+2].length<=4?(a+=c+". "+candidate_letter[n]+"\n",_=!0):a+=7==n&&candidate_letter[n+1].length>1?c+". "+candidate_letter[n]+" +:下頁\n":c+". "+candidate_letter[n]+" ",c++,10==c&&(c=0);r+="+:下一頁",r="關聯詞"+interval+"("+currentPage+"/"+totalPage+")\n"+r,1==_&&(a+=" +:下頁"),$("#show").html(r),$("#show_flat").html(a)}mode=2},"json")}function search_auto(){$("#input"),document.getElementById("input"),$("#prompt"),$("#prompt_flat");auto_change_flag=!0,$.post(servicePath+"search_word_auto.php",{auto_KEY:auto_search_key},function(e){if(""==e)return $("#show, #show_flat").html(""),void(mode=0);auto_letter=[],auto_pinyin=[];for(var t=Object.keys(e).length-1,n=e[0],o=1;t>=o;o++)auto_letter[o-1]=e[o].character,auto_pinyin[o-1]=e[o].pinyin;var i=!1;if(input_loc==auto_start&&(i=!0),n){if(i){var r=auto_search_key.search(auto_pinyin[3]);auto_search_key=auto_search_key.substring(0,r),auto_start=pinyin_record[auto_pointer[0]].start_loc}else{var r=auto_search_key.search(auto_pinyin[0]),a=auto_pinyin[0].length;auto_search_key=auto_search_key.substring(r+a+1,auto_search_key.length),auto_start=pinyin_record[auto_pointer[1]].start_loc,auto_letter.shift(),auto_pinyin.shift()}console.log("next_auto_search_key: "+auto_search_key),console.log("auto_start: "+auto_start)}for(var t=auto_letter.length,c=[],_=0,l=auto_start,o=0;t>o;o++){console.log("auto_letter["+o+"] = "+auto_letter[o]),_=auto_letter[o].length;var p=l,s=l+_;$.ajaxSettings.async=!1,search_correspond(auto_pinyin[o],auto_letter[o]),$.ajaxSettings.async=!0,correspond_flag?obj=new pinyin_obj(auto_pinyin[o],auto_letter[o],p,s,0):obj=new pinyin_obj(auto_pinyin[o],auto_letter[o],p,s,1),c.push(obj),l+=_}if(0==auto_pointer.length)if(pinyin_record.length>0){for(var o=0;o<pinyin_record.length;o++)switch(pinyin_record[o].modifiable){case 0:console.log("第"+(o+1)+"個拼音: "+pinyin_record[o].pinyin+"; 字詞: "+pinyin_record[o].word+"; 位置為"+pinyin_record[o].start_loc+"~"+pinyin_record[o].end_loc+"; 可被修改");break;case 1:console.log("第"+(o+1)+"個拼音: "+pinyin_record[o].pinyin+"; 字詞: "+pinyin_record[o].word+"; 位置為"+pinyin_record[o].start_loc+"~"+pinyin_record[o].end_loc+"; 可在最前方被修改");break;case 2:console.log("第"+(o+1)+"個拼音: "+pinyin_record[o].pinyin+"; 字詞: "+pinyin_record[o].word+"; 位置為"+pinyin_record[o].start_loc+"~"+pinyin_record[o].end_loc+"; 不可修改")}if(console.log("auto_start: "+auto_start),0!=input_loc){addRecord(c[0],input_loc);var u=getWhichWord(auto_start,"tail");console.log("which_word: "+u),auto_pointer[0]=u+1}else addRecord(c[0],input_loc),auto_pointer[0]=0}else pinyin_record.splice(0,0,c[0]),auto_pointer[0]=0;else{var d=auto_pointer.length,u=getWhichWord(auto_start,"head");n?i?(pinyin_record.splice(auto_pointer[0],d),auto_letter.pop(),auto_pinyin.pop()):pinyin_record.splice(auto_pointer[1],d-1):(console.log("原先的自動選字數: "+d),modify_split_flag?pinyin_record.splice(auto_pointer[0],d+1):pinyin_record.splice(auto_pointer[0],d)),auto_pointer=[];for(var o=0;o<c.length;o++)pinyin_record.splice(u,0,c[o]),auto_pointer[o]=u,u++;n&&i&&auto_pointer.pop()}for(var o=0;o<auto_pointer.length;o++)console.log("auto_pointer["+o+"] = "+auto_pointer[o]);var u=getWhichWord(input_loc,"tail");if(modify_obj_loc(u,0,0),1==pinyin_record[u].modifiable){var s=pinyin_record[u].end_loc,_=pinyin_record[u].word.length,h=getSyllable(pinyin_record[u].pinyin);console.log("input_loc: "+input_loc),console.log("end_loc: "+s),_>h&&d>=auto_pointer.length?input_loc=s:h>_&&d>auto_pointer.length?input_loc=s:input_loc+=candidate_letter[0].length}else input_loc+=candidate_letter[0].length;console.log("input_loc: "+input_loc);for(var o=0;o<pinyin_record.length;o++)switch(pinyin_record[o].modifiable){case 0:console.log("第"+(o+1)+"個拼音: "+pinyin_record[o].pinyin+"; 字詞: "+pinyin_record[o].word+"; 位置為"+pinyin_record[o].start_loc+"~"+pinyin_record[o].end_loc+"; 可被修改");break;case 1:console.log("第"+(o+1)+"個拼音: "+pinyin_record[o].pinyin+"; 字詞: "+pinyin_record[o].word+"; 位置為"+pinyin_record[o].start_loc+"~"+pinyin_record[o].end_loc+"; 可在最前方被修改");break;case 2:console.log("第"+(o+1)+"個拼音: "+pinyin_record[o].pinyin+"; 字詞: "+pinyin_record[o].word+"; 位置為"+pinyin_record[o].start_loc+"~"+pinyin_record[o].end_loc+"; 不可修改")}modify_split_flag=!1},"json")}function search_correspond(e,t){$.post(servicePath+"search_correspond.php",{KEY:e,WORD:t},function(e){correspond_flag=""==e?!1:1==e[0]?!0:!1},"json")}function setWord(){var e=$("#input"),t=$("#prompt"),n=$("#prompt_flat");input_word=remove_tags(input_word);var o=input_word.substring(0,input_loc),i=input_word.substring(input_loc,input_word.length),r=0,a=getWhichWord(input_loc,"head");if(3==mode){var c=pinyin_record[a].word,_=input_loc-pinyin_record[a].start_loc;c=c.substring(_,c.length);var l="",p=0;if(48==keyin||96==keyin?(l=candidate_letter[9+10*(currentPage-1)],p=9+10*(currentPage-1)):keyin>=97?(l=candidate_letter[keyin-97+10*(currentPage-1)],p=keyin-97+10*(currentPage-1)):keyin>=49&&(l=candidate_letter[keyin-49+10*(currentPage-1)],p=keyin-49+10*(currentPage-1)),r=l.length,0!=mod_pinyin_record.length){for(var s="",u=0;u<mod_pinyin_record.length;u++)p>=mod_pinyin_record[u].start_index&&p<mod_pinyin_record[u].end_index&&(s=mod_pinyin_record[u].pinyin);search_key=s}if(0==sel_mode&&c==l){for(var d="",u=0;u<pinyin_record.length;u++)d+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";return e.html(d),search_key="",mode=0,$("#show, #show_flat").html(""),caption_effect(),t.val("選字成功!"),n.val("選字成功!"),void(input_loc+=r)}var h=input_loc+r;1==pinyin_record[a].modifiable&&(h=input_loc+pinyin_record[a].word.length);var y=h,f=getSyllable(search_key);r>f&&(y=input_loc+f),i=input_word.substring(y,input_word.length),input_word=o+l+i;var g="";getSyllable(search_key)==r?($.ajaxSettings.async=!1,search_correspond(search_key,l),$.ajaxSettings.async=!0,g=correspond_flag?new pinyin_obj(search_key,l,input_loc,input_loc+r,0):new pinyin_obj(search_key,l,input_loc,input_loc+r,1)):g=new pinyin_obj(search_key,l,input_loc,input_loc+r,1),$.ajaxSettings.async=!1,addRecord(g,input_loc),$.ajaxSettings.async=!0;for(var d="",u=0;u<pinyin_record.length;u++)d+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";e.html(d),input_len=input_word.length,search_key="",mode=0,auto_change_flag||(input_loc+=r),auto_change_flag=!1}else if(2==mode){var l="";48==keyin||96==keyin?l=candidate_letter[9+10*(currentPage-1)]:keyin>=97?l=candidate_letter[keyin-97+10*(currentPage-1)]:keyin>=49&&(l=candidate_letter[keyin-49+10*(currentPage-1)]),input_word=o+l+i,r=l.length;var g=new pinyin_obj("",l,input_loc,input_loc+r,2);addRecord(g,input_loc);for(var d="",u=0;u<pinyin_record.length;u++)d+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";e.html(d),input_len=input_word.length,prefix_key="",mode=0,input_loc+=r,auto_start=input_loc}else if(1==mode){var l="";48==keyin||96==keyin?l=candidate_letter[9+10*(currentPage-1)]:keyin>=97?l=candidate_letter[keyin-97+10*(currentPage-1)]:keyin>=49&&(l=candidate_letter[keyin-49+10*(currentPage-1)]),input_word=o+l+i,r=l.length,prefix_key=l;var g="";punctuation_search_flag?(g=new pinyin_obj("",l,input_loc,input_loc+r,2),prefix_key=""):getSyllable(search_key)==r?($.ajaxSettings.async=!1,search_correspond(search_key,l),$.ajaxSettings.async=!0,g=correspond_flag?new pinyin_obj(search_key,l,input_loc,input_loc+r,0):new pinyin_obj(search_key,l,input_loc,input_loc+r,1)):g=new pinyin_obj(search_key,l,input_loc,input_loc+r,1),$.ajaxSettings.async=!1,addRecord(g,input_loc),$.ajaxSettings.async=!0;for(var d="",u=0;u<pinyin_record.length;u++)d+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";e.html(d),input_len=input_word.length,search_key="",punctuation_search_flag?(mode=0,l.length>1&&input_loc--):mode=2,punctuation_search_flag=!1,input_loc+=r,1==sel_mode&&(auto_pointer=[],auto_search_key="",auto_start=input_loc)}if(4==mode){var d="";input_word="";for(var u=0;u<pinyin_record.length;u++)d+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>",input_word+=pinyin_record[u].word;e.html(d),search_key=""}$("#show, #show_flat").html(""),caption_effect(),t.val("選字成功!"),n.val("選字成功!")}function deleteWord(e){var t=$("#input"),n=document.getElementById("input"),o=t.html();if(o=remove_tags(o),8!=e){if(46!=e);else if(0==mode&&""==search_key&&0==tow_check){var o=t.html(),i=input_len;o=remove_tags(o),input_word=o,input_len=input_word.length,input_loc=getCaretCharacterOffsetWithin(n);var r=!0;if(0==i)return;if(input_len==i)r=!1;else if(r&&1==pinyin_record.length&&1==pinyin_record[0].word.length)pinyin_record=[],auto_pointer=[],auto_start=0;else if(r&&pinyin_record.length>1||pinyin_record[0].word.length>1){var a=getWhichWord(input_loc,"head"),c=pinyin_record[a].pinyin,_=pinyin_record[a].word;if(1!=_.length){var l=input_loc-pinyin_record[a].start_loc,p=_.substring(0,l),s=_.substring(l+1,_.length);l=pinyin_record[a].start_loc,_=p+s,""!=c&&(c=split_key(c,l,input_loc)),console.log("word: "+_),$.ajaxSettings.async=!1,rearrange_objs(c,_,a,1,0),$.ajaxSettings.async=!0}else $.ajaxSettings.async=!1,rearrange_objs("","",a,0,0),$.ajaxSettings.async=!0;for(var o="",u=0;u<pinyin_record.length;u++)o+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";t.html(o),t.setCursorPosition(input_loc)}}}else if(0==sel_mode){if(0==mode&&""==search_key&&0==tow_check){var o=t.html(),i=input_len;o=remove_tags(o),input_word=o,console.log("input_word: "+input_word),input_len=input_word.length,input_loc=getCaretCharacterOffsetWithin(n);var r=!0;if(0==i)return;if(input_len==i)r=!1;else if(r&&1==pinyin_record.length&&1==pinyin_record[0].word.length)console.log("all clean"),pinyin_record=[],auto_pointer=[],auto_start=0;else if(r&&pinyin_record.length>1||pinyin_record[0].word.length>1){console.log("input_loc: "+input_loc);var a=getWhichWord(input_loc+1,"tail");console.log("which_word: "+a);var c=pinyin_record[a].pinyin,_=pinyin_record[a].word;if(1!=_.length){var l=input_loc-pinyin_record[a].start_loc,p=_.substring(0,l),s=_.substring(l+1,_.length);l=pinyin_record[a].start_loc,_=p+s,""!=c&&(c=split_key(c,l,input_loc)),console.log("word: "+_),$.ajaxSettings.async=!1,rearrange_objs(c,_,a,1,0),$.ajaxSettings.async=!0}else $.ajaxSettings.async=!1,rearrange_objs("","",a,0,0),$.ajaxSettings.async=!0;for(var o="",u=0;u<pinyin_record.length;u++)o+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";t.html(o),t.setCursorPosition(input_loc),modify_obj_loc(a,0,0)}}}else if(1==sel_mode&&0==mode&&""==search_key&&""==auto_search_key&&0==tow_check){var o=t.html(),i=input_len;o=remove_tags(o),input_word=o,console.log("input_word: "+input_word),input_len=input_word.length,input_loc=getCaretCharacterOffsetWithin(n);var r=!0;if(0==i)return;if(input_len==i)r=!1;else if(r&&1==pinyin_record.length&&1==pinyin_record[0].word.length)console.log("all clean"),pinyin_record=[],auto_pointer=[],auto_start=0;else if(r&&pinyin_record.length>1||pinyin_record[0].word.length>1){console.log("input_loc: "+input_loc);var a=getWhichWord(input_loc+1,"tail");console.log("which_word: "+a);var c=pinyin_record[a].pinyin,_=pinyin_record[a].word;if(1!=_.length){var l=input_loc-pinyin_record[a].start_loc,p=_.substring(0,l),s=_.substring(l+1,_.length);l=pinyin_record[a].start_loc,_=p+s,""!=c&&(c=split_key(c,l,input_loc)),console.log("word: "+_),$.ajaxSettings.async=!1,rearrange_objs(c,_,a,1,0),$.ajaxSettings.async=!0}else $.ajaxSettings.async=!1,rearrange_objs("","",a,0,0),$.ajaxSettings.async=!0;for(var o="",u=0;u<pinyin_record.length;u++)o+=2==pinyin_record[u].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[u].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[u].word+"</span>";t.html(o),t.setCursorPosition(input_loc),modify_obj_loc(a,0,0)}}}function rearrange_objs(e,t,n,o,i){if(""!=e){var r=e.split("");if(r[0]==r[0].toUpperCase()){var a=[],c=t.split(""),_=n,l=0;try{l=pinyin_record[n].start_loc}catch(p){l=pinyin_record[n-1].end_loc}var s=l,u=l+1;h=new pinyin_obj(e,c[0],s,u,2),a.push(h);for(var d=1;d<c.length;d++)s=u,u=s+1,h=new pinyin_obj("",c[d],s,u,2),a.push(h);for(var d=0;d<a.length;d++)0==d?pinyin_record.splice(_,1,a[d]):pinyin_record.splice(_,0,a[d]),record_last_index=_,_++}else $.post(servicePath+"pinyin_split.php",{THE_KEY:e},function(r){if(""==r);else{var a=Object.keys(r).length,c=getSyllable(e),_=t.length,l=[],p=0,s=0;try{s=pinyin_record[n].start_loc}catch(u){s=pinyin_record[n-1].end_loc}var d=n,h=0,y=0;if(c>_){var f=t;n>0&&(h=pinyin_record[n-1].end_loc),y=h+_,w=new pinyin_obj("",f,h,y,2),l.push(w)}else{for(var g=0;a>g;g++){var m=r[g],v=getSyllable(m),f=t.substring(p,p+v);_-=f.length,h=p+s,y=p+s+v;var w="";$.ajaxSettings.async=!1,search_correspond(m,f),$.ajaxSettings.async=!0,w=correspond_flag?new pinyin_obj(m,f,h,y,0):new pinyin_obj(m,f,h,y,2),p+=v,l.push(w)}if(_>0){var f=t.substring(t.length-_,t.length);h=y,y=h+_,w=new pinyin_obj("",f,h,y,2),l.push(w)}}for(var g=0;g<l.length;g++)0==g&&o?pinyin_record.splice(d,1,l[g]):pinyin_record.splice(d,0,l[g]),record_last_index=d,d++;modify_obj_loc(n,0,i)}},"json")}else if(""==e&&""==t)modify_obj_loc(n+1,1,0),pinyin_record.splice(n,1);else if(""==e&&""!=t){try{if(o)pinyin_record[n].word=t,pinyin_record[n].end_loc=pinyin_record[n].start_loc+t.length;else{s=pinyin_record[n-1].end_loc,u=s+t.length;var h=new pinyin_obj("",t,s,u,2);pinyin_record.splice(n,0,h)}}catch(p){s=pinyin_record[n-1].end_loc,u=s+t.length;var h=new pinyin_obj("",t,s,u,2);pinyin_record.splice(n,0,h)}modify_obj_loc(n,0,0),record_last_index=n}for(var d=0;d<pinyin_record.length;d++)switch(pinyin_record[d].modifiable){case 0:console.log("第"+(d+1)+"個拼音: "+pinyin_record[d].pinyin+"; 字詞: "+pinyin_record[d].word+"; 位置為"+pinyin_record[d].start_loc+"~"+pinyin_record[d].end_loc+"; 可被修改");break;case 1:console.log("第"+(d+1)+"個拼音: "+pinyin_record[d].pinyin+"; 字詞: "+pinyin_record[d].word+"; 位置為"+pinyin_record[d].start_loc+"~"+pinyin_record[d].end_loc+"; 可在最前方被修改");break;case 2:console.log("第"+(d+1)+"個拼音: "+pinyin_record[d].pinyin+"; 字詞: "+pinyin_record[d].word+"; 位置為"+pinyin_record[d].start_loc+"~"+pinyin_record[d].end_loc+"; 不可修改")}}function modify_obj_loc(e,t,n){var o=e;if(0==t)for(var i=0;i<pinyin_record.length;i++)if(n){if(e>i)continue;pinyin_record[i].start_loc=pinyin_record[o-1].end_loc,pinyin_record[i].end_loc=pinyin_record[i].start_loc+pinyin_record[i].word.length,o++}else{if(e>=i)continue;pinyin_record[i].start_loc=pinyin_record[o].end_loc,pinyin_record[i].end_loc=pinyin_record[i].start_loc+pinyin_record[i].word.length,o++}else if(1==t)for(var r=!1,i=0;i<pinyin_record.length;i++)e>i||(0==r&&o==e?(pinyin_record[i].start_loc=pinyin_record[o-1].start_loc,pinyin_record[i].end_loc=pinyin_record[i].start_loc+pinyin_record[i].word.length,r=!0,o--):(pinyin_record[i].start_loc=pinyin_record[o].end_loc,pinyin_record[i].end_loc=pinyin_record[i].start_loc+pinyin_record[i].word.length),o++)}function pinyin_obj(e,t,n,o,i){this.pinyin=e,this.word=t,this.start_loc=n,this.end_loc=o,this.modifiable=i}function modify_record_obj(e,t,n){this.pinyin=e,this.start_index=t,this.end_index=n}function addRecord(e,t){if(pinyin_record.length>0&&t==pinyin_record[pinyin_record.length-1].end_loc)pinyin_record.push(e);else if(0==t){if(3==mode){var n=getWhichWord(t,"head"),o=pinyin_record[n].word,i=pinyin_record[n].pinyin,r=e.word,a=e.pinyin,c=auto_pointer.length;if(console.log("auto_words_num: "+c),r.length==o.length&&getSyllable(a)==getSyllable(i)){if(pinyin_record.splice(0,1,e),c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";auto_start=pinyin_record[auto_pointer[1]].start_loc,auto_pointer.shift(),$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[]}else{var l=getSyllable(a),p=0;p=1==pinyin_record[n].modifiable?o.length:l;var s="",u="",d=o.substring(0,p),h=o.substring(p,o.length),y=0;if(1==pinyin_record[n].modifiable||0==pinyin_record[n].modifiable&&1==getSyllable(i)){if(s=a,e.pinyin=s,console.log("which_word: "+n),pinyin_record.splice(n,1,e),modify_obj_loc(0,0,0),c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";console.log("auto_search_key: "+auto_search_key),auto_start=pinyin_record[auto_pointer[0]].start_loc+pinyin_record[auto_pointer[0]].word.length,console.log("auto_start: "+auto_start),auto_pointer.shift(),$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[];for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}else{for(var _=0;_<i.length;_++)if(" "==i[_]&&y++,y==l){var f=_;s=i.substring(0,f),u=i.substring(f+1,i.length),s=s.trim(),u=u.trim();break}if(e.pinyin=s,pinyin_record.splice(n,1,e),0==sel_mode)$.ajaxSettings.async=!1,rearrange_objs(u,h,n+1,0,0),$.ajaxSettings.async=!0;else{var g=e.end_loc,m=new pinyin_obj(u,h,g,g+h.length,0);if(pinyin_record.splice(n+1,0,m),modify_obj_loc(n,0,0),c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)console.log("pinyin_record[auto_pointer["+_+"]].pinyin = "+pinyin_record[auto_pointer[_]].pinyin),auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";auto_search_key+=pinyin_record[auto_pointer[c-1]+1].pinyin,console.log("auto_search_key: "+auto_search_key),auto_start=pinyin_record[auto_pointer[0]].start_loc+pinyin_record[auto_pointer[0]].word.length,console.log("auto_start: "+auto_start),auto_pointer.shift(),modify_split_flag=!0,$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,input_loc=g,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[];for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}}}}else pinyin_record.unshift(e);$.ajaxSettings.async=!1,modify_obj_loc(0,0,0),$.ajaxSettings.async=!0}else{var n=getWhichWord(t,"head"),o=pinyin_record[n].word,i=pinyin_record[n].pinyin,r=e.word,a=e.pinyin,c=auto_pointer.length;if(t==pinyin_record[n].start_loc){if(3==mode)if(r.length==o.length&&getSyllable(a)==getSyllable(i)){if(pinyin_record.splice(n,1,e),c>0)if(auto_search_key="",c>1){if(n==auto_pointer[0]){auto_start=pinyin_record[auto_pointer[1]].start_loc;for(var _=1;c>_;_++)auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";auto_pointer.shift()}else if(n==auto_pointer[1])auto_start=pinyin_record[auto_pointer[2]].start_loc,auto_search_key=pinyin_record[auto_pointer[2]].pinyin,auto_pointer.shift(),auto_pointer.shift();else if(n==auto_pointer[2])return auto_start=pinyin_record[auto_pointer[2]].end_loc,auto_search_key="",void(auto_pointer=[]);$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,console.log("input_loc: "+input_loc);for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[]}else{var l=getSyllable(a),p=0;p=1==pinyin_record[n].modifiable?o.length:l;var s="",u="",d=o.substring(0,p),h=o.substring(p,o.length),y=0;if(1==pinyin_record[n].modifiable||0==pinyin_record[n].modifiable&&1==getSyllable(i)){if(pinyin_record.splice(n,1,e),modify_obj_loc(n,0,0),c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";console.log("auto_search_key: "+auto_search_key),auto_start=pinyin_record[auto_pointer[0]].start_loc+pinyin_record[auto_pointer[0]].word.length,console.log("auto_start: "+auto_start),auto_pointer.shift(),$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[];for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}else{for(var _=0;_<i.length;_++)if(" "==i[_]&&y++,y==l){var f=_;s=i.substring(0,f),u=i.substring(f+1,i.length),s=s.trim(),u=u.trim();break}if(console.log("pinyin_left: "+s),console.log("pinyin_right: "+u),e.pinyin=s,pinyin_record.splice(n,1,e),0==sel_mode)$.ajaxSettings.async=!1,rearrange_objs(u,h,n+1,0,0),$.ajaxSettings.async=!0;else{var g=e.end_loc,m=new pinyin_obj(u,h,g,g+h.length,0);if(pinyin_record.splice(n+1,0,m),modify_obj_loc(n,0,0),c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)console.log("pinyin_record[auto_pointer["+_+"]].pinyin = "+pinyin_record[auto_pointer[_]].pinyin),auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";auto_search_key+=pinyin_record[auto_pointer[c-1]+1].pinyin,console.log("auto_search_key: "+auto_search_key),auto_start=pinyin_record[auto_pointer[0]].start_loc+pinyin_record[auto_pointer[0]].word.length,console.log("auto_start: "+auto_start),auto_pointer.shift(),modify_split_flag=!0,$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,input_loc=g,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[];for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}}}else pinyin_record.splice(n,0,e);$.ajaxSettings.async=!1,modify_obj_loc(n,0,0),$.ajaxSettings.async=!0}else if(t<=pinyin_record[n].end_loc&&t>pinyin_record[n].start_loc){var v=t-pinyin_record[n].start_loc,w=pinyin_record[n].end_loc-pinyin_record[n].start_loc,l=getSyllable(a),d=o.substring(0,v),h=o.substring(v,w),s="",u="";if(3==mode){var k="",b=o.substring(0,v);console.log("pre_word: "+b),d=o.substring(v,v+l),h=o.substring(v+l,w),o=d+h,console.log("start_loc: "+v);for(var y=0,_=0;_<i.length;_++)if(" "==i[_]&&y++,y==v){var f=_;if(k=i.substring(0,f),i=i.substring(f+1,i.length),k=k.trim(),i=i.trim(),console.log("former_pinyin: "+i),1==getSyllable(i)||getSyllable(i)==l){s=i,u="";break}y=0;for(var j=0;j<i.length;j++)if(" "==i[j]&&y++,y==l){var f=j;s=i.substring(0,f),u=i.substring(f+1,i.length),s=s.trim(),u=u.trim(),console.log("");break}break}if(console.log("pinyin_left: "+s),e.pinyin=s,$.ajaxSettings.async=!1,rearrange_objs(k,b,n,1,0),$.ajaxSettings.async=!0,pinyin_record.splice(record_last_index+1,0,e),0==sel_mode)""!=h&&($.ajaxSettings.async=!1,rearrange_objs(u,h,record_last_index+2,0,1),$.ajaxSettings.async=!0);else if(""!=h){var g=e.end_loc,m=new pinyin_obj(u,h,g,g+h.length,0);if(pinyin_record.splice(record_last_index+2,0,m),modify_obj_loc(n,0,0),c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)console.log("pinyin_record[auto_pointer["+_+"]].pinyin = "+pinyin_record[auto_pointer[_]].pinyin),auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";auto_search_key+=pinyin_record[auto_pointer[c-1]+1].pinyin,console.log("auto_search_key: "+auto_search_key),auto_start=pinyin_record[auto_pointer[0]].start_loc+pinyin_record[auto_pointer[0]].word.length,console.log("auto_start: "+auto_start),auto_pointer.shift(),modify_split_flag=!0,$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,input_loc=g,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[];for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}else{var g=e.end_loc;if(c>0)if(auto_search_key="",c>1){for(var _=1;c>_;_++)console.log("pinyin_record[auto_pointer["+_+"]].pinyin = "+pinyin_record[auto_pointer[_]].pinyin),auto_search_key+=pinyin_record[auto_pointer[_]].pinyin+" ";auto_search_key+=pinyin_record[auto_pointer[c-1]+1].pinyin,console.log("auto_search_key: "+auto_search_key),auto_start=pinyin_record[auto_pointer[0]].start_loc+pinyin_record[auto_pointer[0]].word.length,console.log("auto_start: "+auto_start),auto_pointer.shift(),modify_split_flag=!0,$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,input_loc=g,console.log("input_loc: "+input_loc)}else auto_start=pinyin_record[auto_pointer[0]].end_loc,auto_search_key="",auto_pointer=[];for(var _=0;_<auto_pointer.length;_++)console.log("auto_pointer["+_+"] = "+auto_pointer[_])}modify_obj_loc(n,0,0)}else{var x=getSyllable(i);v=pinyin_record[n].start_loc;var f=t-v;if(""!=i)if(f>x)s=i;else for(var y=0,_=0;_<i.length;_++)if(" "==i[_]&&y++,y==f){var p=_;s=i.substring(0,p),u=i.substring(p+1,i.length),s=s.trim(),u=u.trim();break}$.ajaxSettings.async=!1,rearrange_objs(s,d,n,1,0),$.ajaxSettings.async=!0,pinyin_record.splice(record_last_index+1,0,e),$.ajaxSettings.async=!1,rearrange_objs(u,h,record_last_index+2,0,1),$.ajaxSettings.async=!0}}}for(var _=0;_<pinyin_record.length;_++)switch(pinyin_record[_].modifiable){case 0:console.log("第"+(_+1)+"個拼音: "+pinyin_record[_].pinyin+"; 字詞: "+pinyin_record[_].word+"; 位置為"+pinyin_record[_].start_loc+"~"+pinyin_record[_].end_loc+"; 可被修改");break;case 1:console.log("第"+(_+1)+"個拼音: "+pinyin_record[_].pinyin+"; 字詞: "+pinyin_record[_].word+"; 位置為"+pinyin_record[_].start_loc+"~"+pinyin_record[_].end_loc+"; 可在最前方被修改");break;case 2:console.log("第"+(_+1)+"個拼音: "+pinyin_record[_].pinyin+"; 字詞: "+pinyin_record[_].word+"; 位置為"+pinyin_record[_].start_loc+"~"+pinyin_record[_].end_loc+"; 不可修改")}}function split_key(e,t,n){for(var o=0,i="",r=0;r<e.length;r++)if(" "==e[r]&&o++,o==n-t){var a=r;if(0!=a){var c=e.substring(0,a),_=e.substring(a+1,e.length),l=_.search(" ");c=c.trim(),_=_.trim(),-1==l?i=c:(_=_.substring(l+1,_.length),i=c+" "+_)}else{var l=e.search(" ");i=e.substring(l+1,e.length)}break}return i}function getWhichWord(e,t){if(pinyin_record.length>0&&e==pinyin_record[pinyin_record.length-1].end_loc)return pinyin_record.length-1;for(var n=0;n<pinyin_record.length;n++){if(0==e)return 0;if("tail"==t){if(e>pinyin_record[n].start_loc&&e<=pinyin_record[n].end_loc)return n}else if("head"==t&&e>=pinyin_record[n].start_loc&&e<pinyin_record[n].end_loc)return n}}function getSyllable(e){for(var t=0,n=0,o=0;o<e.length;o++)" "==e[o]&&t++;return n=t+1}function getKey(e){var t=$("#input"),n=document.getElementById("input"),o=getCaretCharacterOffsetWithin(n),i=t.html();i=remove_tags(i),input_len=input_word.length;var r=i.length-input_len;if(8==e&&(1==search_key.length&&o==input_loc&&(search_key="",associated_search_flag=!1),input_loc+search_key.length==o?search_key=search_key.substr(0,r):input_loc+search_key.length>o?search_key=i.substr(input_loc,r):0==sel_mode&&input_loc>o&&deleteWord(e)),
46==e&&(1==search_key.length&&o==input_loc&&(search_key="",associated_search_flag=!1),o==input_loc+search_key.length&&reachRight()?deleteWord(e):input_loc==o?search_key=search_key.substr(1,r):o>input_loc&&(search_key=search_key.substr(0,r))),e>=65&&90>=e||32==e)if(0==input_len){var a=i,c=o-1;search_key_loc=c;var _=a.substring(0,search_key_loc),l=a.substring(search_key_loc,r);search_key=_+l}else if(0==input_loc){var a=i.substring(0,r),_=a.substring(0,search_key_loc),l=a.substring(search_key_loc,r);search_key=_+l}else{var a=i.substring(input_loc,input_loc+r);search_key_loc=o-1;var p=i.substring(0,input_loc),c=0;search_key_loc-getCaretCharacterOffsetWithin(n)>=0?search_key_loc-=input_len:(c=o-1,search_key_loc=c-p.length);var _=a.substring(0,search_key_loc),l=a.substring(search_key_loc,r);search_key=_+l}for(var s=[" &nbsp; "," &nbsp;","&nbsp;"],u=s.length,d=0;u>d;d++)for(var h=s[d];search_key.search(h)>=0;)search_key=search_key.replace(h," ");search_key=search_key.trim(),console.log("search_key: "+search_key),console.log("")}function remove_tags(e){var t=['<span id="first" class="in_pinyin_window">','<span id="second" class="in_pinyin_window">','<span id="third" class="in_pinyin_window">','<span class="in_pinyin_window">','<span class="in_pinyin_window cannotMod">',"</span>","</u>","<u>","<br>"],n=e;0==n.search("<br>")&&(n=n.replace("<br>",""));for(var o=t.length,i=0;o>i;i++)for(var r=t[i];n.search(r)>=0;)n=n.replace(r,"");return n}function getPage(){totalPage=parseInt(number_letters/10),number_letters%10!=0&&totalPage++}function getCaretCharacterOffsetWithin(e){var t,n=0,o=e.ownerDocument||e.document,i=o.defaultView||o.parentWindow;if(void 0!==typeof i.getSelection){if(t=i.getSelection(),t.rangeCount>0){var r=i.getSelection().getRangeAt(0),a=r.cloneRange();a.selectNodeContents(e),a.setEnd(r.endContainer,r.endOffset),n=a.toString().length}}else if((t=o.selection)&&"Control"!=t.type){var c=t.createRange(),_=o.body.createTextRange();_.moveToElementText(e),_.setEndPoint("EndToEnd",c),n=_.text.length}return n}function reachHead(){return 1==currentPage?!0:void 0}function reachTail(){return currentPage==totalPage?!0:void 0}function reachLeft(){var e=($("#input"),document.getElementById("input")),t=getCaretCharacterOffsetWithin(e);if(0==sel_mode){if(input_loc==t)return!0}else if(1==sel_mode&&input_loc==t)return!0}function reachRight(){var e=($("#input"),document.getElementById("input")),t=getCaretCharacterOffsetWithin(e);return 0==sel_mode&&input_loc+search_key.length==t?!0:1==sel_mode&&input_loc+search_key.length==t?!0:void 0}function isNumber(e){return e>=48&&57>=e?!0:e>=96&&105>=e?!0:!1}function nav_assign_white(e){return $(navArr[e]).css("color","white"),e}function nav_restore_color(e){$(navArr[e]).css("color",nav_color[e])}function caption_effect(){var e=setInterval(function(){$("#prompt, #prompt_flat").val(""),clearInterval(e)},1800)}function change_theme(e,t){var n=["black","pink","blue","xmas","green"];nav_assign_color(e),customJqte.remove(),customJqteFlat.remove(),$("#jqte_place").append('<textarea id="jqte" readonly></textarea>'),$("#jqte_place_flat").append('<textarea id="jqte_flat" readonly></textarea>');var o="jqte_"+e,i="jqte_"+e+"_flat";if($("#jqte").jqte({css:o}),customJqte=$("."+o),$("#jqte_flat").jqte({css:i}),customJqteFlat=$("."+i),void 0!==typeof Storage){localStorage.setItem("theme",e);var r=localStorage.getItem("text",r);$(".jqte_"+e+"_editor").html(r),$(".jqte_"+e+"_flat_editor").html(r)}$(".jqte_"+e+"_editor").change(function(){var e=$(this).html();localStorage.setItem("text",e)}),$(".jqte_"+e+"_flat_editor").change(function(){var e=$(this).html();localStorage.setItem("text",e)});for(var a=0;a<n.length;a++)$("#theme_"+n[a]).attr("disabled",!0),e==n[a]&&$("#theme_"+e).attr("disabled",!1);applyTheme=e,t||$.fn.fullpage.moveTo(2,1)}function nav_assign_color(e){var t=["rgb(240, 160, 28)","#F87284","#F1EE8F","#8AE194","#5B81E9","rgb(171, 145, 249)"],n=navArr.length;if("black"==e){static_color="#fff";for(var o=0;n>o;o++)$(navArr[o]).css("color",t[o]),$(navArr[o]).on("mouseenter",function(){$(this).css("color",static_color)}),function(e){$(navArr[e]).mouseleave(function(){$(this).css("color",t[e])})}(o)}else if("pink"==e||"blue"==e||"xmas"==e||"green"==e){static_color="#fff";for(var o=0;n>o;o++)$(navArr[o]).css("color",static_color),function(e){$(navArr[e]).mouseenter(function(){$(this).css("color",t[e])})}(o),$(navArr[o]).mouseleave(function(){$(this).css("color",static_color)})}}function generate_prompt_btn(e){$("#hide_btn").delay("500").fadeIn(),generate_open(),generate_close()}function generate_open(){$("#open_prompt").click(function(){if($("#prompt_flat").is(":hidden")){var e=($("#input"),$("#prompt"),isPopupHidden());e&&($("#input").popup({content:"這是輸入欄，請在此輸入台語的羅馬拼音並選字，例如:a, bbe, diong, ggu, uan...等等",position:"left center"}).popup("hide"),$("#select_mode").popup({content:"這是選擇不同輸入模式的滑動選單",position:"left center"}).popup("hide"),$("#prompt").popup({content:"這是簡易提示欄，成功或失敗操作時會有提示",position:"left center"}).popup("hide"),$("#copy").popup({content:"這是複製按鈕，將輸入的文字複製到剪貼簿",position:"left center"}).popup("hide"),$("#clear").popup({content:"這是清除按鈕，按下後將把輸入框清空",position:"bottom center"}).popup("hide"),$("#cut").popup({content:"這是剪下按鈕，將輸入的文字剪下到剪貼簿",position:"right center"}).popup("hide"),$("#show").popup({content:"這是文字顯示區，符合拼音的字詞將顯示在裡面",position:"right center"}).popup("hide"),customJqte.attr("data-variation","large"),customJqte.attr("data-offset",35),customJqte.popup({content:"這是文字編輯器，可以將輸入完的字詞在此進行編輯",position:"left center"}).popup("hide"),$("#search_pinyin").popup({content:"這是反向查詢區，不會拼音的中文字可在這查拼音",position:"bottom center"}).popup("hide"))}else $("#input").popup({content:"這是輸入欄，請在此輸入台語的羅馬拼音並選字，例如:a, bbe, diong, ggu, uan...等等",position:"top center"}).popup("hide"),$("#prompt_flat").popup({content:"這是簡易提示欄，成功或失敗操作時會有提示",position:"right center"}).popup("hide"),$("#show_flat").popup({content:"這是文字顯示區，符合拼音的字詞將顯示在裡面",position:"top center"}).popup("hide"),customJqteFlat.popup({content:"這是文字編輯器，可以將輸入完的字詞在此進行編輯",position:"left center"}).popup("hide"),$("#search_pinyin").popup({content:"這是反向查詢區，不會拼音的中文字可在這查拼音",position:"bottom center"}).popup("show");$("#prompt, #prompt_flat").val("提示功能已開啟!"),caption_effect()})}function generate_close(){$("#close_prompt").click(function(){$("#input").popup("hide"),$("#select_mode").popup("hide"),$("#prompt, #prompt_flat").popup("hide"),$("#copy").popup("hide"),$("#clear").popup("hide"),$("#cut").popup("hide"),$("#show, #show_flat").popup("hide"),customJqte.popup("hide"),customJqteFlat.popup("hide"),$("#search_pinyin").popup("hide");var e=setInterval(function(){$("#input").popup("destroy"),$("#select_mode").popup("destroy"),$("#prompt, #prompt_flat").popup("destroy"),$("#copy").popup("destroy"),$("#clear").popup("destroy"),$("#cut").popup("destroy"),$("#show, #show_flat").popup("destroy"),customJqte.popup("destroy"),customJqteFlat.popup("destroy"),$("#search_pinyin").popup("destroy"),$("#prompt, #prompt_flat").val("提示功能已關閉!"),caption_effect(),clearInterval(e)},100)})}function isPopupHidden(){for(var e=["#input","#select_mode","#prompt","#copy","#clear","#cut","#show","#search_pinyin"],t=!1,n=($("#input").popup("is hidden"),0);n<e.length;n++){if(!$(e[n]).popup("is hidden")){t=!1;break}t=!0}return t?t=t&&customJqte.popup("is hidden")?!0:!1:t}function ispopup_flat_hidden(){for(var e=["#input","#prompt_flat","#show_flat","#search_pinyin"],t=!1,n=0;n<e.length;n++){if(!$(e[n]).popup("is hidden")){t=!1;break}t=!0}return t?t=t&&customJqteFlat.popup("is hidden")?!0:!1:t}function change_pic(){click_count++,5==click_count&&($("body").queue("AnimateQrcode",function(e){setTimeout(function(){$("#change_qr").html('<img src="./images/pokerface.png" width="120px" height="120px" style="margin-left: 18px; margin-top: 5px; margin-bottom: 2px"/><br><br>'),e()},350)}).queue("AnimateQrcode",function(e){setTimeout(function(){$("#change_qr").html('<img src="./images/pinyinQR.png" id="my_qrcode" onclick="change_pic()" width="160px" height="160px" style="margin-top: -13px"/>'),$("#my_qrcode").click(function(){$(this).transition("tada")})},800)}),$("body").dequeue("AnimateQrcode"),click_count=0)}function getTutorial(){$.getJSON("tutorial.json",function(e){for(var t=e.length,n="",o=0;t>o;o++){var i=e[o].consonant,r=e[o].vowel,a=r.length,c="<tr>";c+='<td style="color: #FD529A; font-weight: bold">'+i+'<i class="arrow right icon hidden-xs" style="float: right; margin-top: 2px"></i><i class="arrow down icon visible-xs" style="float: right"></i></td>';for(var _=0;a>_;_++){var l=r[_].sound,p=r[_].word,s=p.length,u=i.toUpperCase()+l.toUpperCase();"－"==l&&(u=i.toUpperCase()),$('<audio id="sound_'+u+'"><source src="./tutorial_sound/'+u+'-MingShingYu-20060622.wav" type="audio/wav"></audio>').appendTo("body"),c+='<td><span style="color: #E78AD0">'+i+"</span>"+l+"<a href=\"javascript: play_sound('"+u+'\');"><i class="large volume down icon" style="float: right"></i></a></td>',c+="<td>";for(var d=0;s>d;d++)c+=d==s-1?p[d]:p[d]+", ";c+="</td>"}c+="</tr>",n+=c}$("#json_table, #json_table_flat").html(n)})}function play_sound(e){$("#sound_"+e)[0].play()}function controlPlay(){if(play_sound_flag=!play_sound_flag){$("#prompt, #prompt_flat").val("已開啟發音功能!");var e='<i class="large unmute icon"></i>';$("#control_play").html(e)}else{$("#prompt, #prompt_flat").val("已關閉發音功能!");var e='<i class="large mute icon"></i>';$("#control_play").html(e)}caption_effect(),$("#input").setCursorPosition(input_loc)}function google(){var e=remove_tags($("#input").html());if(""==e)$("#prompt, #prompt_flat").val("搜尋字串不能為空白!"),caption_effect();else{for(var t=["℃","℉","㎏","㎎","㎜","㎝","㎡","㏄","㏎"],n=["°C","°F","kg","mg","mm","cm","m^2","cc","km"],o=t.length,i=0;o>i;i++)for(var r=t[i],a=n[i];e.search(r)>=0;)e=e.replace(r,a);e="https://www.google.com.tw/webhp?sourceid=chrome-instant&ion=1&espv=2&es_th=1&ie=UTF-8#q="+e;var c=e.replace(" ","+");window.open(c)}}function setDefault(){$(window).on("load",function(e){"#_=_"==window.location.hash&&(window.location.hash="",history.pushState("",document.title,window.location.pathname),e.preventDefault())}),$("#hide_btn").hide(),$("#hide_panel").hide(),$('<audio id="chatAudio"><source src="error.mp3" type="audio/mpeg"></audio>').appendTo("body");for(var e=["#shortcut","control_play_flat","#tutor_table_flat"],t="",n=0;n<e.length;n++)t+=n<e.length-1?e[n]+",":e[n];$("#fullpage").fullpage({anchors:["home","pinyin_IME","about","tutorial","contact"],menu:"#menu",keyboardScrolling:!1,slidesNavigation:!0,scrollOverflow:!0,css3:!0,normalScrollElements:t}),$("#my_qrcode").click(function(){$(this).transition("tada")}),$(".ui.dropdown").dropdown(),$(".ui.checkbox").checkbox(),$("#search_pinyin").autocomplete({source:servicePath+"search_pinyin.php"}),$(".menu .item").tab();var o=["black","pink","blue","xmas","green"],i="";if("undefined"!=typeof Storage){var r=localStorage.getItem("theme");if(i=localStorage.getItem("text"),null!=r){applyTheme=r;for(var n=0;n<o.length&&applyTheme!=o[n];n++);}}var a="jqte_"+applyTheme,c=a+"_flat";$("#jqte").jqte({css:a}),$("#jqte_flat").jqte({css:c}),$(".jqte_"+applyTheme+"_editor").html(i),$(".jqte_"+applyTheme+"_flat_editor").html(i),customJqte=$("."+a),customJqteFlat=$("."+c),change_theme(applyTheme,!0),getTutorial(),$("#prompt_flat").is(":hidden")||($("#manual").css({"padding-left":"5px","padding-right":"5px"}),$(".tutorial_prompt").css("font-size","16px")),$(".trigger").click(function(e){e.preventDefault(),$.fn.fullpage.moveSectionDown()}),$("#index_title").click(function(){$("#index_title").transition("flash")}),$("#select_mode").checkbox(),$("#select_mode").click(function(){if(0==sel_mode)if($("#select_mode").checkbox("is checked")){var e=$("#input"),t=e.html(),n=t.search('<span class="in_pinyin_window">');if(n>=0){var o=remove_tags(t);input_word=o;var i=input_word.length;pinyin_record=[];var r=new pinyin_obj("",input_word,0,i,2);$.ajaxSettings.async=!1,addRecord(r,0),$.ajaxSettings.async=!0,input_loc=i,console.log("input_loc: "+input_loc),input_len=input_word.length,e.html(input_word),e.setCursorPosition(input_loc),mode=0,search_key="",auto_search_key="",auto_start=input_loc,auto_pointer=[],$("#show, #show_flat").html("")}$("#prompt, #prompt_flat").val("切換至智能模式!"),caption_effect(),sel_mode=1}else;else if(1==sel_mode)if($("#select_mode").checkbox("is checked"));else{var e=$("#input"),t=e.html(),n=t.search('<span class="in_pinyin_window">');if(n>=0){var o=remove_tags(t);input_word=o;var i=input_word.length;pinyin_record=[];var r=new pinyin_obj("",input_word,0,i,2);$.ajaxSettings.async=!1,addRecord(r,0),$.ajaxSettings.async=!0,input_loc=i,console.log("input_loc: "+input_loc),input_len=input_word.length,e.html(input_word),mode=0,search_key="",auto_search_key="",auto_start=input_loc,auto_pointer=[],$("#show, #show_flat").html("")}$("#prompt, #prompt_flat").val("切換至自選模式!"),caption_effect(),sel_mode=0}$("#input").setCursorPosition(input_loc),console.log("sel_mode: "+sel_mode)});var _=document.getElementById("input"),l=document.getElementById("input_page"),p=document.getElementById("search_pinyin"),s={is_unordered:!0,prevent_repeat:!0},u=new window.keypress.Listener(_,s),d=new window.keypress.Listener(l,s),h=new window.keypress.Listener(p,s);u.simple_combo("ctrl c",function(){var e=remove_tags($("#input").html());if(""!=e){$("#prompt, #prompt_flat").val("已複製到右方編輯器!");var t=$(".jqte_"+applyTheme+"_editor").html();$(".jqte_"+applyTheme+"_editor").html(t+e),caption_effect(),$("#input").setCursorPosition(input_loc)}else $("#prompt, #prompt_flat").val("沒有內容可複製!"),caption_effect(),$("#input").focus()}),u.simple_combo("ctrl x",function(){var e=remove_tags($("#input").html());if(""!=e){$("#prompt, #prompt_flat").val("已剪下到右方編輯器!"),input_word="",pinyin_record=[],auto_pointer=[],mode=0,console.log("input_loc: "+input_loc),input_loc=0,auto_start=0,search_key="",auto_search_key="",$("#input").html(""),$("#show, #show_flat").html("");var t=$(".jqte_"+applyTheme+"_editor").html();$(".jqte_"+applyTheme+"_editor").html(t+e),caption_effect(),$("#input").setCursorPosition(0)}else $("#prompt, #prompt_flat").val("沒有內容可剪下!"),caption_effect(),$("#input").focus()}),u.simple_combo("ctrl z",function(){return $("#prompt, #prompt_flat").val("本輸入區無法復原(ctrl + z) !"),caption_effect(),$("#input").focus(),!1}),u.simple_combo("ctrl v",function(){return $("#prompt, #prompt_flat").val("本輸入區無法貼上(ctrl + v) !"),caption_effect(),$("#input").focus(),!1}),u.simple_combo("ctrl delete",function(){$("#input").html(""),$("#show, #show_flat").html(""),pinyin_record=[],auto_pointer=[],mode=0,input_word="",search_key="",auto_search_key="",input_loc=0,auto_start=0,record_last_index=-1,associated_search_flag=!1,$("#input").setCursorPosition(0),$("#prompt, #prompt_flat").val("輸入框已清空!"),caption_effect()}),u.simple_combo("ctrl alt",function(){if(0==sel_mode)if(1==$("#select_mode").checkbox("is checked"));else{var e=$("#input"),t=e.html(),n=t.search('<span class="in_pinyin_window">');if(n>=0){var o=remove_tags(t);input_word=o;var i=input_word.length;pinyin_record=[];var r=new pinyin_obj("",input_word,0,i,2);$.ajaxSettings.async=!1,addRecord(r,0),$.ajaxSettings.async=!0,input_loc=i,console.log("input_loc: "+input_loc),input_len=input_word.length,e.html(input_word),mode=0,search_key="",auto_search_key="",auto_start=input_loc,auto_pointer=[],$("#show, #show_flat").html("")}$("#select_mode").checkbox("check"),$("#prompt, #prompt_flat").val("切換至智能模式!"),caption_effect(),sel_mode=1,e.setCursorPosition(input_loc)}else if(1==sel_mode)if(0==$("#select_mode").checkbox("is checked"));else{var e=$("#input"),t=e.html(),n=t.search('<span class="in_pinyin_window">');if(n>=0){var o=remove_tags(t);input_word=o;var i=input_word.length;pinyin_record=[];var r=new pinyin_obj("",input_word,0,i,2);$.ajaxSettings.async=!1,addRecord(r,0),$.ajaxSettings.async=!0,input_loc=i,console.log("input_loc: "+input_loc),input_len=input_word.length,e.html(input_word),mode=0,search_key="",auto_search_key="",auto_start=input_loc,auto_pointer=[],$("#show, #show_flat").html("")}e.setCursorPosition(input_loc),$("#prompt, #prompt_flat").val("切換至自選模式!"),caption_effect(),$("#select_mode").checkbox("uncheck"),sel_mode=0}}),u.simple_combo("alt v",function(){if(play_sound_flag=!play_sound_flag){$("#prompt, #prompt_flat").val("已開啟發音功能!");var e='<i class="large unmute icon"></i>';$("#control_play, #control_play_flat").html(e)}else{$("#prompt, #prompt_flat").val("已關閉發音功能!");var e='<i class="large mute icon"></i>';$("#control_play, #control_play_flat").html(e)}caption_effect(),$("#input").setCursorPosition(input_loc)}),d.simple_combo("alt b",function(){$("#prompt").val("焦點移至反查拼音區"),caption_effect(),$("#search_pinyin").focus()}),d.simple_combo("alt n",function(){$("#prompt").val("焦點移至中央拼音區"),caption_effect(),""!=$("#input").html()?$("#input").setCursorPosition(input_loc):$("#input").focus()}),d.simple_combo("alt m",function(){$("#prompt").val("焦點移至文字編輯區"),caption_effect(),$(".jqte_"+applyTheme+"_editor").focus()}),h.simple_combo("tab",function(){""!=$("#input").html()?$("#input").setCursorPosition(input_loc):$("#input").focus()})}var servicePath="../app/Services/",navArr=["#nav_home","#nav_log","#nav_input","#nav_about","#nav_tutorial","#nav_contact"],applyTheme="black",customJqte="",customJqteFlat="",sel_mode=0,mode=0,search_key="",part_key="",search_key_loc=0,prefix_key="",auto_search_key="",auto_start=0,auto_letter=[],auto_pinyin=[],auto_pointer=[],pinyin_record=[],record_last_index=0,candidate_letter=[],mod_pinyin_record=[],number_letters=0,keyin=0,input_word="",input_len=0,input_loc=0,show_text="",show_flat_text="",mousedown_loc=0,totalPage=0,currentPage=1,correspond_flag=!1,auto_change_flag=!1,modify_split_flag=!1,play_sound_flag=!0,tow_check=!1,associated_search_flag=!1,punctuation_search_flag=!1,interval="		",click_count=0;$(document).ready(function(){Pace.on("done",function(){$("#index_title").transition("flash")});var e=$("#input"),t=document.getElementById("input"),n=$("#prompt"),o=$("#prompt_flat");setDefault(),$("#input").mousedown(function(){mousedown_loc=getCaretCharacterOffsetWithin(t)}).mousemove(function(){}).mouseup(function(){mouseup_loc=getCaretCharacterOffsetWithin(t),0==sel_mode&&0==mode&&""==search_key&&(input_loc=mouseup_loc),show_text=$("#show").html(),1==tow_check&&""!=show_text?e.setCursorPosition(input_loc):0!=tow_check||2!=mode&&3!=mode||getCaretCharacterOffsetWithin(t)==input_loc?0==tow_check&&""!=show_text&&(console.log("search_key_loc: "+search_key_loc),(getCaretCharacterOffsetWithin(t)>input_loc+search_key.length||getCaretCharacterOffsetWithin(t)<input_loc)&&e.setCursorPosition(mousedown_loc)):(mode=0,$("#show, #show_flat").html(""),input_loc=getCaretCharacterOffsetWithin(t))}),$("#input").keydown(function(e){keyin=e.keyCode;var t=$("#input"),n=document.getElementById("input"),o=$("#prompt"),i=$("#prompt_flat");if(229==keyin){var r="請切換至英文輸入法!";return o.val(r),i.val(r),caption_effect(),!1}if(45==keyin){var r="本輸入法不支援insert鍵!";return o.val(r),i.val(r),caption_effect(),!1}if(show_text=$("#show").html(),220==keyin)return(0==mode&&""==show_text||2==mode||3==mode||4==mode)&&$.getJSON("dict_punctuation.json",function(e){var t=e.punctuation;number_letters=t.length,currentPage=1,getPage(),candidate_letter=[];for(var n=0;number_letters>n;n++)candidate_letter[n]=t[n];for(var o="",i="",r=!1,a=1,n=0;10>n;n++)o+=a+". "+candidate_letter[n]+"\n",3==n?i+=a+". "+candidate_letter[n]+"\n":7==n&&candidate_letter[n+1].length<=4&&candidate_letter[n+2].length<=4?(i+=a+". "+candidate_letter[n]+"\n",r=!0):i+=7==n&&candidate_letter[n+1].length>1?a+". "+candidate_letter[n]+" +:下頁\n":a+". "+candidate_letter[n]+" ",a++,10==a&&(a=0);o+="+:下一頁",o="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+o,1==r&&(i+=" +:下頁"),$("#show, #show_flat").html(o),mode=1,punctuation_search_flag=!0}),!1;if(186==keyin||188==keyin||190==keyin||191==keyin||192==keyin||219==keyin||221==keyin||222==keyin){if(0==mode&&""==show_text||2==mode||3==mode||4==mode){var a="";186==keyin?a="；":188==keyin?a="，":190==keyin?a="。":191==keyin?a="？":192==keyin?a="~":219==keyin?a="「":221==keyin?a="」":222==keyin&&(a="、");var c=new pinyin_obj("",a,input_loc,input_loc+1,2);mode=0,$.ajaxSettings.async=!1,addRecord(c,input_loc),$.ajaxSettings.async=!0;for(var r="",_=0;_<pinyin_record.length;_++)r+=2==pinyin_record[_].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[_].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[_].word+"</span>";return t.html(r),input_word=remove_tags(t.html()),input_len=input_word.length,input_loc++,auto_start=input_loc,console.log("auto_start: "+auto_start),t.setCursorPosition(input_loc),search_key="",auto_search_key="",auto_pointer=[],prefix_key="",$("#show, #show_flat").html(""),!1}return!1}if(""==show_text||"無此拼音，請按backspace或delete調整拼音"==show_text){if(107==keyin||187==keyin)return!1;if(109==keyin||189==keyin)return!1}if(8==keyin){if(0==sel_mode){if((0==mode&&""!=search_key||1==mode)&&1==reachLeft()){var r="目前無法刪字!";return o.val(r),i.val(r),caption_effect(),!1}(2==mode||3==mode)&&(mode=0,$("#show, #show_flat").html(""),prefix_key="",search_key="",input_loc=getCaretCharacterOffsetWithin(n))}if(1==sel_mode&&2==mode&&1==reachLeft())return!1}if(13==keyin){if(0==mode&&0==associated_search_flag||2==mode||4==mode){var t=$("#input"),l=t.html(),p=l.search('<span class="in_pinyin_window">');if(p>=0){var r=remove_tags(l);input_word=r;var s=input_word.length;pinyin_record=[];var c=new pinyin_obj("",input_word,0,s,2);$.ajaxSettings.async=!1,addRecord(c,0),$.ajaxSettings.async=!0,input_loc=s,console.log("input_loc: "+input_loc),input_len=input_word.length,t.html(input_word),t.setCursorPosition(input_loc),mode=0,search_key="",auto_search_key="",auto_start=input_loc,auto_pointer=[],$("#show, #show_flat").html("")}else{var r="此區無法換行!";o.val(r),i.val(r),caption_effect()}}else{var r="現在不能按Enter!";o.val(r),i.val(r),caption_effect()}return!1}if(32==keyin){if(0==sel_mode){if(0==mode&&""==search_key||2==mode||3==mode){c=new pinyin_obj(""," ",input_loc,input_loc+1,2),$.ajaxSettings.async=!1,addRecord(c,input_loc),$.ajaxSettings.async=!0;for(var r="",_=0;_<pinyin_record.length;_++)r+=2==pinyin_record[_].modifiable?'<span class="in_pinyin_window cannotMod">'+pinyin_record[_].word+"</span>":'<span class="in_pinyin_window">'+pinyin_record[_].word+"</span>";return t.html(r),input_word=remove_tags(t.html()),input_len=input_word.length,input_loc++,t.setCursorPosition(input_loc),(2==mode||3==mode)&&(search_key="",prefix_key="",mode=0,$("#show, #show_flat").html("")),!1}}else if(1==sel_mode&&1==mode){var u=0;if(auto_pointer.length>0&&(u=pinyin_record[auto_pointer[auto_pointer.length-1]].end_loc),u>input_loc)if(input_loc==auto_start)console.log("auto_search_key: "+auto_search_key),auto_search_key=search_key+" "+auto_search_key;else if(input_loc>=auto_start){var d=0,h=input_loc-auto_start,y=!0,f=getWhichWord(input_loc,"tail");console.log("which_word: "+f);var s=pinyin_record[f].word.length;console.log("word: "+pinyin_record[f].word);var g=getSyllable(pinyin_record[f].pinyin),m=0,v=0,w=0,k=0;f>=1&&(m=pinyin_record[f-1].word.length,w=getSyllable(pinyin_record[f-1].pinyin)),f>=2&&(v=pinyin_record[f-2].word.length,k=getSyllable(pinyin_record[f-2].pinyin));var b=-1,j=-1;if(s!=g&&pinyin_record[f].end_loc==input_loc)if(s>g){var x=s-g;h=input_loc-auto_start-x,b=0}else if(g>s){var x=g-s;h=input_loc-auto_start+x,j=0}if(f>=1&&m!=w&&-1!=auto_pointer.indexOf(f-1))if(m>w){var x=m-w;h=input_loc-auto_start-x,b=1}else if(w>m){var x=w-m;h=input_loc-auto_start+x,j=1}if(console.log("ws_flag: "+b),console.log("sw_flag: "+j),(1==b&&0==j||0==b&&1==j)&&(h=input_loc-auto_start),console.log("split_loc: "+h),y)for(var _=0;_<auto_search_key.length;_++)if(" "==auto_search_key[_]&&d++,d==h){var P=_,S=auto_search_key.substring(0,P),C=auto_search_key.substring(P,auto_search_key.length);console.log("left: "+S),console.log("right: "+C),auto_search_key=S+" "+search_key+C;break}}else auto_start>input_loc&&(auto_pointer=[],auto_start=input_loc,auto_search_key=search_key+" ");else auto_search_key+=search_key+" ";console.log("auto_search_key: "+auto_search_key+"\n"),$.ajaxSettings.async=!1,search_auto(),$.ajaxSettings.async=!0,mode=4}if(1==associated_search_flag){var r="拼音提示下不能按空白!";return o.val(r),i.val(r),caption_effect(),!1}}if(35==keyin){if(0==mode){if(0==sel_mode&&1==associated_search_flag)return t.setCursorPosition(input_loc+search_key.length),!1}else if(1==mode||"無此拼音，請按backspace或delete調整拼音"==show_text)return t.setCursorPosition(input_loc+search_key.length),!1;(2==mode||3==mode)&&(mode=0,prefix_key="",search_key="",$("#show, #show_flat").html(""),candidate_letter=[])}if(36==keyin){if(0==mode){if(1==associated_search_flag)return t.setCursorPosition(input_loc),!1}else if(1==mode||"無此拼音，請按backspace或delete調整拼音"==show_text)return t.setCursorPosition(input_loc),!1;(2==mode||3==mode)&&(mode=0,prefix_key="",search_key="",$("#show, #show_flat").html(""),input_loc=getCaretCharacterOffsetWithin(n))}if(37==keyin){if(reachLeft()){if(0==mode&&""!=search_key)return!1;if(1==mode)return!1}(2==mode||3==mode)&&(mode=0,prefix_key="",search_key="",$("#show, #show_flat").html(""),input_loc=getCaretCharacterOffsetWithin(n))}if(39==keyin){if(reachRight()){if(0==mode&&""!=search_key)return!1;if(1==mode)return!1}(2==mode||3==mode)&&(mode=0,prefix_key="",search_key="",$("#show, #show_flat").html(""),input_loc=getCaretCharacterOffsetWithin(n))}if(40==keyin&&""==search_key){var f=getWhichWord(input_loc,"head");switch(auto_pointer.length>0&&input_loc<pinyin_record[auto_pointer[0]].start_loc&&(auto_pointer=[],auto_start=input_loc,auto_search_key=""),auto_change_flag=!1,pinyin_record[f].modifiable){case 0:for(var q=pinyin_record[f].pinyin,T=pinyin_record[f].start_loc,d=0,_=0;_<q.length;_++)if(" "==q[_]&&d++,d==input_loc-T){var W=_;search_key=q.substring(W,q.length),search_key=search_key.trim();break}return console.log("search_key: "+search_key),mode=3,$.ajaxSettings.async=!1,search_char(2),$.ajaxSettings.async=!0,!1;case 1:var q=pinyin_record[f].pinyin,T=pinyin_record[f].start_loc;pinyin_record[f].end_loc;if(input_loc==T)search_key=q,mode=3,$.ajaxSettings.async=!1,search_char(0),$.ajaxSettings.async=!0;else{var r="此處無法修改，請移至最前端!";o.val(r),i.val(r),caption_effect()}return!1;case 2:var r="此字詞無法修改!";return o.val(r),i.val(r),caption_effect(),!1}}if(46==keyin)if(0==sel_mode){if((0==mode&&""!=search_key||1==mode)&&1==reachRight()){var r="目前無法刪字!";return o.val(r),i.val(r),caption_effect(),!1}(2==mode||3==mode)&&(mode=0,$("#show, #show_flat").html(""),prefix_key="",search_key="",input_loc=getCaretCharacterOffsetWithin(n))}else if(1==sel_mode&&2==mode&&1==reachLeft())return!1;if((0==mode||1==associated_search_flag)&&isNumber(keyin)){var r="現在還不能選字!";return o.val(r),i.val(r),caption_effect(),!1}if(0==sel_mode&&(2==mode||3==mode)&&keyin>=37&&40>=keyin&&(mode=0,$("#show, #show_flat").html(""),search_key="",prefix_key=""),(0!=mode||1==associated_search_flag)&&1==reachTail()){if(107==keyin||187==keyin){if(1==totalPage);else{var r="已達最末頁!";o.val(r),i.val(r),caption_effect()}return!1}if(isNumber(keyin)&&keyin>=96){if(keyin-96+10*(currentPage-1)>number_letters||96==keyin&&10*currentPage>number_letters){var r="該號碼無法選擇!";return o.val(r),i.val(r),caption_effect(),!1}}else if(isNumber(keyin)&&keyin>=48&&96>keyin&&(keyin-48+10*(currentPage-1)>number_letters||48==keyin&&10*currentPage>number_letters)){var r="該號碼無法選擇!";return o.val(r),i.val(r),caption_effect(),!1}}if(!(0==mode&&1!=associated_search_flag||1!=reachHead()||109!=keyin&&189!=keyin)){if(1==totalPage);else{var r="已達首頁!";o.val(r),i.val(r),caption_effect()}return!1}if(107==keyin||187==keyin){currentPage++;for(var A="",O="",_=0+10*(currentPage-1),I=0,E=1,J=!1;number_letters>_&&10>I;)A+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n",(_%10==3||_%10==7)&&totalPage>currentPage?(_%10==3&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n"),_%10==7&&candidate_letter[_+1].length<=4&&candidate_letter[_+2].length<=4?(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n",J=!0):_%10==7&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+" +:下頁\n":"● "+candidate_letter[_]+" +:下頁\n")):_%10!=3&&_%10!=7||currentPage!=totalPage?O+=0==associated_search_flag?E+". "+candidate_letter[_]+" ":"● "+candidate_letter[_]+" ":(_%10==3&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n"),_%10==7&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n")),_++,I++,E++,10==E&&(E=0);return totalPage>currentPage?(A+="+:下一頁 -:上一頁",1==J&&(O+=" +:下頁"),O+=" -:上頁"):(A+="-:上一頁",O+="-:上頁"),0==mode&&(A="拼音提示"+interval+"("+currentPage+"/"+totalPage+")\n"+A),(1==mode||3==mode)&&(A="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+A),2==mode&&(A="關聯詞"+interval+"("+currentPage+"/"+totalPage+")\n"+A),$("#show").html(A),$("#show_flat").html(O),!1}if(109==keyin||189==keyin){currentPage--;for(var A="",O="",_=0+10*(currentPage-1),I=0,E=1,J=!1;number_letters>_&&10>I;)A+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n",(_%10==3||_%10==7)&&totalPage>currentPage?(_%10==3&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n"),_%10==7&&candidate_letter[_+1].length<=4&&candidate_letter[_+2].length<=4?(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n",J=!0):_%10==7&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+" +:下頁\n":"● "+candidate_letter[_]+" +:下頁\n")):_%10!=3&&_%10!=7||currentPage!=totalPage?O+=0==associated_search_flag?E+". "+candidate_letter[_]+" ":"● "+candidate_letter[_]+" ":(_%10==3&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n"),_%10==7&&(O+=0==associated_search_flag?E+". "+candidate_letter[_]+"\n":"● "+candidate_letter[_]+"\n")),_++,I++,E++,10==E&&(E=0);return totalPage>currentPage&&currentPage>1?(A+="+:下一頁 -:上一頁",1==J&&(O+=" +:下頁"),O+=" -:上頁"):(A+="+:下一頁",O+=" +:下頁"),0==mode&&(A="拼音提示"+interval+"("+currentPage+"/"+totalPage+")\n"+A),(1==mode||3==mode)&&(A="候選字"+interval+"("+currentPage+"/"+totalPage+")\n"+A),2==mode&&(A="關聯詞"+interval+"("+currentPage+"/"+totalPage+")\n"+A),$("#show").html(A),$("#show_flat").html(O),!1}}).keyup(function(e){keyin=e.keyCode,37!=keyin&&39!=keyin||1==mode||0==mode&&""!=search_key||(input_loc=getCaretCharacterOffsetWithin(t),1==sel_mode&&0==auto_pointer.length&&(auto_start=input_loc)),35!=keyin&&36!=keyin||0!=mode||0!=associated_search_flag||(input_loc=getCaretCharacterOffsetWithin(t))}).on("input",function(t){if(0==sel_mode?(keyin>=65&&90>=keyin||32==keyin||8==keyin||46==keyin||37==keyin||39==keyin)&&getKey(keyin):1==sel_mode&&(keyin>=65&&90>=keyin||8==keyin||46==keyin)&&getKey(keyin),(8==keyin||46==keyin||32==keyin||keyin>=65&&90>=keyin)&&deleteWord(keyin),0!=mode){if(1==sel_mode&&(32==keyin||isNumber(keyin)))return setWord(),e.setCursorPosition(input_loc),void(""!=prefix_key&&search_associated());if(isNumber(keyin))return setWord(),e.setCursorPosition(input_loc),currentPage=1,totalPage=1,void(""!=prefix_key&&search_associated());totalPage>1&&107!=keyin&&187!=keyin&&109!=keyin&&189!=keyin&&(currentPage=1,totalPage=1)}return""==search_key?($("#show, #show_flat").html(""),n.val(""),o.val(""),void(mode=0)):void search_char(0)}),$("#clear").click(function(){$("#input").html(""),$("#show, #show_flat").html(""),pinyin_record=[],auto_pointer=[],mode=0,input_word="",search_key="",auto_search_key="",input_loc=0,auto_start=0,record_last_index=-1,associated_search_flag=!1,$("#prompt, #prompt_flat").val("輸入框已清空!"),$("#input").setCursorPosition(0),caption_effect()}),$("#copy").zclip({path:"./js/ZeroClipboard.swf",copy:function(){var e=remove_tags($("#input").html());if(""!=e){$("#prompt, #prompt_flat").val("已複製到剪貼簿!");var t=$(".jqte_"+applyTheme+"_editor").html();return $(".jqte_"+applyTheme+"_editor").html(t+e),caption_effect(),$("#input").setCursorPosition(input_loc),e}return $("#prompt, #prompt_flat").val("沒有內容可複製!"),
caption_effect(),void $("#input").focus()}}),$("#cut").zclip({path:"./js/ZeroClipboard.swf",copy:function(){var e=remove_tags($("#input").html());if(""!=e){$("#prompt, #prompt_flat").val("已剪下到剪貼簿!"),input_word="",pinyin_record=[],auto_pointer=[],mode=0,input_loc=0,record_last_index=-1,search_key="",auto_search_key="",$("#input").html(""),$("#show, #show_flat").html(""),associated_search_flag=!1;var t=$(".jqte_"+applyTheme+"_editor").html();return $(".jqte_"+applyTheme+"_editor").html(t+e),caption_effect(),$("#input").setCursorPosition(0),e}return $("#prompt, #prompt_flat").val("沒有內容可剪下!"),caption_effect(),void $("#input").focus()}}),$("#GO").click(function(){var e=$("#tutorial_panel").height();$("body").queue("AnimateTutorial",function(e){$("#tutorial_panel").fadeOut("2000",function(){e()})}).queue("AnimateTutorial",function(t){$("#hide_panel").height(e+22).show(function(){t()})}),$("#prompt_flat").is(":hidden")?$("body").queue("AnimateTutorial",function(e){setTimeout(function(){$("#input").popup({content:"這是輸入欄，請在此輸入台語的羅馬拼音並選字，例如:a, bbe, diong, ggu, uan...等等",position:"left center"}).popup("show"),e()},500)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#input").popup("hide"),$("#google_btn").popup({content:"這是用來將所打字詞進行Google搜尋的按鈕",position:"left center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#google_btn").popup("hide"),$("#prompt").popup({content:"這是簡易提示欄，成功或失敗操作時會有提示",position:"left center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#prompt").popup("hide"),$("#copy").popup({content:"這是複製按鈕，將輸入的文字複製到剪貼簿",position:"left center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#copy").popup("hide"),$("#clear").popup({content:"這是清除按鈕，按下後將把輸入框清空",position:"bottom center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#clear").popup("hide"),$("#cut").popup({content:"這是剪下按鈕，將輸入的文字剪下到剪貼簿",position:"right center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#cut").popup("hide"),$("#show").popup({content:"這是文字顯示區，符合拼音的字詞將顯示在裡面",position:"right center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#show").popup("hide"),customJqte.attr("data-variation","large"),customJqte.attr("data-offset",35),customJqte.popup({content:"這是文字編輯器，可以將輸入完的字詞在此進行編輯",position:"left center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){customJqte.popup("hide"),$("#search_pinyin").popup({content:"這是反向查詢區，不會拼音的中文字可在這查拼音",position:"bottom center"}).popup("show"),e()},3e3)}).queue("AnimateTutorial",function(e){setTimeout(function(){$("#search_pinyin").popup("hide"),generate_prompt_btn(),$("#input").focus(),e()},3e3)}):$("body").queue("AnimateTutorial",function(e){setInterval(function(){$("#input").popup({content:"這是輸入欄，請在此輸入台語的羅馬拼音並選字，例如:a, bbe, diong, ggu, uan...等等",position:"top center"}).popup("show")},3e3)}).queue("AnimateTutorial",function(e){setInterval(function(){$("#input").popup("hide"),$("#google_btn").popup({content:"這是用來將所打字詞進行Google搜尋的按鈕",position:"left center"}).popup("show")},3e3)}).queue("AnimateTutorial",function(e){setInterval(function(){$("#prompt_flat").popup({content:"這是簡易提示欄，成功或失敗操作時會有提示",position:"right center"}).popup("show")},3e3)}).queue("AnimateTutorial",function(e){setInterval(function(){$("#prompt_flat").popup("hide"),$("#show_flat").popup({content:"這是文字顯示區，符合拼音的字詞將顯示在裡面",position:"top center"}).popup("show")},3e3)}).queue("AnimateTutorial",function(e){setInterval(function(){$("#show_flat").popup("hide"),customJqteFlat.popup({content:"這是文字編輯器，可以將輸入完的字詞在此進行編輯",position:"top center"}).popup("show")},3e3)}).queue("AnimateTutorial",function(e){setInterval(function(){customJqteFlat.popup("hide"),$("#search_pinyin").popup({content:"這是反向查詢區，不會拼音的中文字可在這查拼音",position:"bottom center"}).popup("show")},3e3)}).queue("AnimateTutorial",function(e){setInterval(function(){$("#search_pinyin").popup("hide"),generate_prompt_btn(),$("#input").focus()},3e3)}),$("body").dequeue("AnimateTutorial")}),$("#NO").click(function(){var e=$("#tutorial_panel").height();generate_prompt_btn(),$("#hide_panel").height(e+22),$("#tutorial_panel").fadeOut("2000",function(){$("#hide_panel").show()}),$("#input").focus()}),$(function(){$("#input").focusout(function(){var e=$(this);e.text().replace(" ","").length||e.empty()})})}),$.fn.setCursorPosition=function(e){var t=document.getElementById("input"),n=document.createRange(),o=window.getSelection();if(0!=pinyin_record.length){var i=getWhichWord(e,"tail"),r=e-pinyin_record[i].start_loc;try{t=t.childNodes[i],t=t.childNodes[0],n.setStart(t,r)}catch(a){t=document.getElementById("input"),t=t.childNodes[0],n.setStart(t,r)}}else 0==e&&n.setStart(t,e);n.collapse(!0),o.removeAllRanges(),o.addRange(n),$("#input").focus()};